#!/bin/bash

function run_bench {
  (ulimit -t 259200 > .tmp; ulimit -H -t > .tmp; ulimit -m 200000000 > .tmp; ulimit -v 200000000 > .tmp; ulimit -H -v > .tmp;
  { /usr/bin/time -f "Time %E / Memory %Mk" ../../deepsec -semantics Private -distributed 36 -distant_workers grenade deepsec 23 -nb_sets $4 Protocols_SatEquiv/$3 > .deepsec_tmp$1 ;} 2> .time_tmp$1;
  time=$(< .time_tmp$1);
  query_result1=$(grep "Query" .deepsec_tmp$1);
  query_result2=$(sed '/Query/s/Query \([0-9][0-9]*\): Equivalent processes : See a summary of the input file on the HTML interface/Query \1: Equivalent/' <<< $query_result1);
  query_result3=$(sed '/Query/s/Query \([0-9][0-9]*\): Processes not equivalent : See a summary of the input file and the attack trace on the HTML interface/Query \1: Not equivalent/' <<< $query_result2);
  echo "Bench $1 / $2 / Result $query_result3 / $time" >> bench_result.txt;);
}

echo "Benchmark DeepSec" > bench_result.txt;
echo "" >> bench_result.txt;

run_bench 1 "DenningSacco 3" Denning-Sacco-A/ds-3.txt 100
run_bench 5 "Needham-Schroeder 3" Needham-Schroeder/ns-3.txt 100
run_bench 10 "Otway-Rees 3" Otway-Rees/or-tagged-3.txt 100
run_bench 12 "Toy 1" Toy/token-1.txt 100
run_bench 13 "Toy 2" Toy/token-2.txt 100
run_bench 16 "WMF 3" Wide_Mouth-Frog/wmf-without-timestamps-3.txt 100
run_bench 20 "Yahalom-lowe 3" Yahalow-lowe/yahalom-lowe-3.txt 100
run_bench 24 "Yahalom-Paulson 3" Yahalow-Paulson/yahalom-paulson-3.txt 100


run_bench 2 "DenningSacco 6" Denning-Sacco-A/ds-6.txt 4000
run_bench 7 "Needham-Schroeder 6" Needham-Schroeder/ns-6.txt 4000
run_bench 11 "Otway-Rees 6" Otway-Rees/or-tagged-6.txt 5000
run_bench 14 "Toy 3" Toy/token-3.txt 5000
run_bench 17 "WMF 6" Wide_Mouth-Frog/wmf-without-timestamps-6.txt 500
run_bench 18 "WMF 7" Wide_Mouth-Frog/wmf-without-timestamps-7.txt 1000
run_bench 21 "Yahalom-lowe 6" Yahalow-lowe/yahalom-lowe-6.txt 5000
run_bench 25 "Yahalom-Paulson 6" Yahalow-Paulson/yahalom-paulson-6.txt 6000


run_bench 3 "DenningSacco 7" Denning-Sacco-A/ds-7.txt 7000
run_bench 4 "DenningSacco 10" Denning-Sacco-A/ds-7.txt 12000
run_bench 8 "Needham-Schroeder 7" Needham-Schroeder/ns-7.txt 7000


run_bench 9 "Needham-Schroeder 10" Needham-Schroeder/ns-7.txt 12000
run_bench 15 "Toy 4" Toy/token-4.txt 10000
run_bench 19 "WMF 10" Wide_Mouth-Frog/wmf-without-timestamps-10.txt 7000
run_bench 22 "Yahalom-lowe 7" Yahalow-lowe/yahalom-lowe-7.txt 10000
run_bench 23 "Yahalom-lowe 10" Yahalow-lowe/yahalom-lowe-10.txt 15000
